extends ../../layout/default.pug
block main
  .container.container-profile
    .row.justify-content-center
      .col-md-3
        .card.card-saved.mb-4
          .card-body.card-body-saved
            .list-group
              h5.list-group-item.active Các thao tác
              a.list-group-item(href="/profile")
                i.fas.fa-user.me-2
                | Thông tin cá nhân 
              a.list-group-item(href="/saved")
                i.fas.fa-heart.me-2
                | Sách yêu thích
      .col-md-9
        .card.card-saved
          .card-header.text-center.bg-gradient-primary.text-white.py-4
            h1.animate__animated.animate__fadeInDown Sách yêu thích
            hr
          .card-body.card-body-saved
            .row.row-cols-1.row-cols-sm-2.row-cols-md-3.row-cols-lg-4.g-4
              each item in products
                .col
                  a.card.card-saved.shadow-sm.border-0.text-decoration-none(href=`/detail/${item.productID}`)
                    .card-body.card-body-saved.d-flex.flex-column
                      img.img-saved(src=`${item.image}`, alt=`${item.name}`)
                      p.p-saved.card-title.text-center.mt-3 #{item.name}
                      .flex-grow-1
                      .text-center.mt-auto
                        button.btn.btn-danger(onclick=`removeFromFavorites('${item._id}')`) 
                          i.fas.fa-trash-alt
        
        style. 
            @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap')
            @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css')
            @import url('https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css')

            .body{
                font-family: 'Roboto', sans-serif
                background-color: #f8f9fa
            }

            .container-profile {
                margin-top: 30px
            }

            .card-header {
                background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%)
            }

            .btn-primary {
                background-color: #2575fc
                border-color: #2575fc
                font-size: 1rem
                padding: 0.6rem 1.2rem
            }

            .btn-primary:hover {
                background-color: #1a63d8
                border-color: #1a63d8
            }

            .btn-danger {
                font-size: 1rem
                padding: 0.6rem 1.2rem
            }

            .p-saved {
                display: -webkit-box
                -webkit-line-clamp: 2
                -webkit-box-orient: vertical
                overflow: hidden
                text-overflow: ellipsis
            }

            .card-body-saved {
                display: flex
                flex-direction: column
                height: 100%
            }

            .card-body-saved .flex-grow-1 {
                flex-grow: 1
            }

            .card-body-saved .text-center.mt-auto {
                margin-top: auto
            }

            .card-saved {
                height: 100%
            }

            .img-saved {
                max-width: 100%
                height: auto
            }

            script(src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js')
            script(src='https://kit.fontawesome.com/a076d05399.js')
            link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css')

        script.
            function removeFromFavorites(productId) {
                fetch(`/remove-from-favorites/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId })
                })
                .then(response => response.json())
                .then(data => {
                if (data.success) {
                    location.reload();
                } else { 
                    alert('Failed to remove the product from favorites.');
                }
                })
                .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while removing the product from favorites.');
                });
            }
